# 機能要件詳細定義書

**作成日**: 2025年10月19日  
**プロジェクト**: Tenjin MCP Hub  
**ドキュメントタイプ**: Functional Requirements Document (FRD)  
**バージョン**: 1.1  

## 1. 概要

本文書では、教育機関向けマルチベンダーMCPサービスの機能要件を詳細に定義します。各機能は実装可能性、テスト可能性、及びユースケースとの整合性を考慮して設計されています。

### 1.1 機能要件カテゴリ
- **FR-USER**: ユーザー管理機能
- **FR-CONTENT**: コンテンツ管理機能
- **FR-API**: APIキー管理機能
- **FR-PROVIDER**: プロバイダー管理機能
- **FR-SEARCH**: 検索・フィルタリング機能
- **FR-BILLING**: 課金・収益分配機能
- **FR-ANALYTICS**: 分析・レポート機能
- **FR-INTEGRATION**: LMS連携機能

## 2. FR-USER: ユーザー管理機能

### 2.1 ユーザー認証機能

#### FR-USER-001: 多要素認証（MFA）
**優先度**: P0  
**説明**: セキュリティ強化のため、すべてのユーザータイプに対してMFAを提供する  
**受け入れ基準**:
- SMS、メール、認証アプリ（TOTP）による2段階認証
- Azure AD B2Cとの統合
- 教育機関管理者は機関内ユーザーのMFA強制可能
- MFA設定の柔軟性（任意/必須の切り替え）

**関連ユースケース**: UC-EU-001（アカウント作成）、UC-EU-002（セキュアログイン）

#### FR-USER-002: SSO統合
**優先度**: P1  
**説明**: 教育機関の既存認証システムとのシングルサインオン  
**受け入れ基準**:
- SAML 2.0、OAuth 2.0、OpenID Connect対応
- 主要教育機関システム（Google Workspace for Education、Microsoft 365 Education）との統合
- 自動プロビジョニング機能
- ユーザー属性マッピング機能

**関連ユースケース**: UC-EU-003（教育機関システム連携）

### 2.2 ユーザープロファイル管理

#### FR-USER-003: 階層的ユーザー管理
**優先度**: P0  
**説明**: プラットフォーム、プロバイダー、テナント、エンドユーザーの4階層管理  
**受け入れ基準**:
- プラットフォーム管理者：システム全体の管理権限
- プロバイダー管理者：自社コンテンツ・顧客管理権限
- テナント管理者：機関内ユーザー・リソース管理権限
- エンドユーザー：個人プロファイル・学習データ管理権限
- 権限の継承と委譲機能

**関連ユースケース**: UC-CP-001（プロバイダー登録）、UC-EU-004（管理者権限管理）

#### FR-USER-004: 個人データ管理
**優先度**: P0  
**説明**: GDPR準拠の個人データ管理機能  
**受け入れ基準**:
- データエクスポート機能（JSON、CSV形式）
- データ削除機能（Right to be forgotten）
- データ処理履歴の記録
- プライバシー設定の詳細制御
- 同意管理機能

**関連ユースケース**: UC-EU-005（プライバシー管理）

### 2.3 ロールベースアクセス制御（RBAC）

#### FR-USER-005: 詳細権限管理
**優先度**: P0  
**説明**: きめ細かい権限制御とロール管理  
**受け入れ基準**:
- 事前定義ロール：SuperAdmin、PlatformAdmin、ProviderAdmin、TenantAdmin、Educator、Student、Developer
- カスタムロール作成機能
- リソースレベルの権限設定
- 権限の時限設定機能
- 監査ログ機能

**関連ユースケース**: UC-EU-004（管理者権限管理）、UC-EU-010（開発者アクセス）

## 3. FR-CONTENT: コンテンツ管理機能

### 3.1 コンテンツライフサイクル管理

#### FR-CONTENT-001: マルチメディアコンテンツ対応
**優先度**: P0  
**説明**: 多様な教材形式の統一管理  
**受け入れ基準**:
- 対応形式：PDF、DOCX、MP4、MP3、SCORM、xAPI、H5P、HTML5
- ファイルサイズ制限：単一ファイル最大2GB、コース単位最大10GB
- 自動形式変換機能（可能な場合）
- メタデータ自動抽出
- コンテンツプレビュー機能

**関連ユースケース**: UC-CP-003（コンテンツアップロード）、UC-EU-006（コンテンツ閲覧）

#### FR-CONTENT-002: バージョン管理
**優先度**: P1  
**説明**: コンテンツの版管理とデプロイメント制御  
**受け入れ基準**:
- セマンティックバージョニング（Major.Minor.Patch）
- 版間の差分表示
- ロールバック機能
- 段階的デプロイメント（ステージング→本番）
- 下位互換性チェック

**関連ユースケース**: UC-CP-004（コンテンツ更新）

#### FR-CONTENT-003: コンテンツ配信最適化
**優先度**: P1  
**説明**: 高速かつ効率的なコンテンツ配信  
**受け入れ基準**:
- Azure CDN統合による地理的分散配信
- 適応ビットレート配信（動画コンテンツ）
- コンテンツキャッシュ戦略
- 帯域制限対応
- オフライン同期機能

**関連ユースケース**: UC-EU-006（コンテンツ閲覧）、UC-EU-007（オフライン学習）

### 3.2 コンテンツセキュリティ

#### FR-CONTENT-004: DRM保護
**優先度**: P1  
**説明**: 知的財産権保護のためのデジタル著作権管理  
**受け入れ基準**:
- Azure Media Services DRM統合
- 暗号化ストリーミング
- ウォーターマーク埋め込み
- 不正ダウンロード防止
- 利用時間・回数制限

**関連ユースケース**: UC-CP-005（知的財産保護）

### 3.3 コンテンツメタデータ管理

#### FR-CONTENT-005: 教育メタデータ標準対応
**優先度**: P0  
**説明**: 国際教育メタデータ標準への準拠  
**受け入れ基準**:
- IEEE LOM（Learning Object Metadata）対応
- Dublin Core対応
- QTI（Question & Test Interoperability）対応
- カスタムメタデータフィールド定義
- 多言語メタデータサポート

**関連ユースケース**: UC-CP-003（コンテンツアップロード）、UC-EU-008（詳細検索）

## 4. FR-API: APIキー管理機能

### 4.1 APIキーライフサイクル管理

#### FR-API-001: APIキー発行・管理
**優先度**: P0  
**説明**: セキュアなAPIアクセス制御  
**受け入れ基準**:
- 階層別キー発行（テナント管理者、開発者、アプリケーション）
- キーローテーション機能（自動・手動）
- 有効期限設定（最短1日、最長1年）
- キー無効化・再有効化機能
- 緊急時の一括無効化機能

**関連ユースケース**: UC-EU-009（APIキー発行）、UC-EU-010（開発者アクセス）

#### FR-API-002: APIクォータ管理
**優先度**: P0  
**説明**: 公平で持続可能なリソース利用制御  
**受け入れ基準**:
- リクエスト数制限（分/時/日/月単位）
- 帯域幅制限
- 同時接続数制限
- 課金プランによる制限の差別化
- 制限超過時の段階的制御（警告→レート制限→一時停止）

**関連ユースケース**: UC-EU-010（開発者アクセス）、UC-EU-011（API利用監視）

### 4.2 API認証・認可

#### FR-API-003: 多層認証システム
**優先度**: P0  
**説明**: APIキー + JWT による多層認証  
**受け入れ基準**:
- APIキーによる初期認証
- JWTトークンによるセッション管理
- リフレッシュトークン機能
- スコープベースの権限制御
- IP制限機能

**関連ユースケース**: UC-EU-010（開発者アクセス）

## 5. FR-PROVIDER: プロバイダー管理機能

### 5.1 プロバイダー向けAPI管理

#### FR-PROVIDER-001: プロバイダー専用APIキー発行
**優先度**: P0  
**説明**: コンテンツプロバイダーが自社のAPIキーを発行・管理する機能  
**受け入れ基準**:
- プロバイダー専用管理画面での APIキー生成
- APIキー別の権限スコープ設定（読み取り専用、読み書き、管理者権限）
- APIキーの有効期限設定（無期限、1年、6ヶ月、3ヶ月、1ヶ月）
- APIキーの即座無効化・再生成機能
- APIキー使用状況の詳細ログ表示
- 同時発行可能なAPIキー数の制限設定

**関連ユースケース**: UC-CP-010（API統合・連携）

#### FR-PROVIDER-002: API使用量監視・制御
**優先度**: P1  
**説明**: プロバイダーが発行したAPIキーの使用状況監視  
**受け入れ基準**:
- リアルタイムAPI使用量ダッシュボード
- APIキー別の使用統計（時間別、日別、月別）
- レート制限の設定・変更（1分間/時間/日あたりのリクエスト数）
- 使用量アラート設定（閾値超過時の通知）
- IP別アクセス制限設定
- 異常なアクセスパターンの自動検出・通知

**関連ユースケース**: UC-CP-008（分析・レポート）

### 5.2 契約情報管理

#### FR-PROVIDER-003: 契約情報閲覧・管理
**優先度**: P0  
**説明**: プロバイダーが自社の契約情報を閲覧・管理する機能  
**受け入れ基準**:
- 現在の契約ステータス表示（アクティブ、保留、終了）
- 契約開始日・終了日・更新日の明確な表示
- 契約プラン詳細（ストレージ容量、帯域制限、手数料率）
- 契約変更履歴の完全な追跡記録
- 契約更新・変更申請のオンライン手続き
- 契約書類のデジタル署名・ダウンロード機能

**関連ユースケース**: UC-CP-001（プロバイダー登録・オンボーディング）、UC-CP-006（収益管理・課金設定）

#### FR-PROVIDER-004: 収益・支払い情報管理
**優先度**: P0  
**説明**: プロバイダーの収益と支払い情報の詳細管理  
**受け入れ基準**:
- 月次・四半期・年次の収益レポート
- コンテンツ別・顧客別の売上詳細
- プラットフォーム手数料の明細表示
- 支払い予定日・支払い履歴の確認
- 税務関連書類（請求書、支払調書）の自動生成
- 多通貨対応での収益表示
- 銀行振込先・PayPal等の支払い方法設定

**関連ユースケース**: UC-CP-006（収益管理・課金設定）

### 5.3 プロバイダーダッシュボード

#### FR-PROVIDER-005: 統合管理ダッシュボード
**優先度**: P1  
**説明**: プロバイダー向けの包括的な管理画面  
**受け入れ基準**:
- 重要指標のリアルタイム表示（売上、アクセス数、API使用量）
- カスタマイズ可能なウィジェット配置
- アラート・通知の一元管理
- 直近のアクティビティフィード表示
- クイックアクション（APIキー生成、コンテンツアップロード等）
- モバイル対応のレスポンシブデザイン
- 多言語対応（日本語、英語、中国語、韓国語）

**関連ユースケース**: UC-CP-002（プロバイダー認証・プロファイル管理）、UC-CP-008（分析・レポート）

#### FR-PROVIDER-006: プロバイダー間連携機能
**優先度**: P2  
**説明**: プロバイダー同士の協業・連携を支援する機能  
**受け入れ基準**:
- パートナープロバイダーとのコンテンツ共同開発機能
- 収益分配設定（共同開発コンテンツの売上配分）
- プロバイダー間のメッセージング機能
- 共同マーケティング企画の管理
- コンテンツバンドリング（複数プロバイダーのコンテンツセット販売）
- プロバイダー評価・レビューシステム

**関連ユースケース**: UC-CP-009（マーケティング・プロモーション）

## 6. FR-SEARCH: 検索・フィルタリング機能

### 5.1 高度検索機能

#### FR-SEARCH-001: 全文検索・意味検索
**優先度**: P0  
**説明**: AIを活用した高精度な教材検索  
**受け入れ基準**:
- 全文検索エンジン（Azure Cognitive Search）
- 意味検索（セマンティック検索）
- 多言語検索対応
- ファジー検索（あいまい検索）
- 検索結果の関連度ランキング

**関連ユースケース**: UC-EU-008（詳細検索）

#### FR-SEARCH-002: 高度フィルタリング
**優先度**: P1  
**説明**: 多次元での教材絞り込み機能  
**受け入れ基準**:
- 教育レベル別フィルタ（K-12、高等教育、職業訓練、企業研修）
- 科目・分野別フィルタ
- コンテンツタイプ別フィルタ
- 難易度・習熟度フィルタ
- 利用時間・期間フィルタ
- カスタムフィルタ作成機能

**関連ユースケース**: UC-EU-008（詳細検索）

### 5.2 パーソナライゼーション

#### FR-SEARCH-003: 学習推奨システム
**優先度**: P1  
**説明**: 個人の学習履歴に基づく教材推奨  
**受け入れ基準**:
- 学習履歴分析による推奨
- 協調フィルタリング
- コンテンツベースフィルタリング
- A/Bテスト機能
- 推奨理由の説明機能

**関連ユースケース**: UC-EU-008（詳細検索）

## 6. FR-BILLING: 課金・収益分配機能

### 6.1 多層課金システム

#### FR-BILLING-001: 柔軟な課金モデル
**優先度**: P0  
**説明**: 多様なビジネスモデルに対応した課金システム  
**受け入れ基準**:
- プロバイダー→プラットフォーム：手数料モデル（5-15%）
- プラットフォーム→テナント：サブスクリプション、従量課金、買い切り
- 段階料金設定
- プロモーション・割引機能
- 複数通貨対応

**関連ユースケース**: UC-CP-006（収益管理）、UC-CP-007（課金管理）

#### FR-BILLING-002: 自動収益分配
**優先度**: P0  
**説明**: リアルタイムでの収益分配処理  
**受け入れ基準**:
- 日次自動決済処理
- 分配ルール設定機能
- 源泉徴収・税務処理
- 支払い方法の選択（銀行振込、PayPal、Stripe）
- 支払い履歴・明細書生成

**関連ユースケース**: UC-CP-006（収益管理）

### 6.2 財務管理

#### FR-BILLING-003: 包括的財務レポート
**優先度**: P1  
**説明**: 財務状況の透明性確保  
**受け入れ基準**:
- リアルタイム収益ダッシュボード
- 月次/四半期/年次レポート
- 税務申告用データエクスポート
- 予測分析機能
- 異常検知アラート

**関連ユースケース**: UC-CP-008（財務分析）

## 7. FR-ANALYTICS: 分析・レポート機能

### 7.1 学習分析

#### FR-ANALYTICS-001: 学習者行動分析
**優先度**: P1  
**説明**: 学習効果向上のための詳細分析  
**受け入れ基準**:
- 学習時間・進捗追跡
- コンテンツ利用パターン分析
- 習熟度評価
- 学習パス最適化提案
- 退学リスク予測

**関連ユースケース**: UC-EU-012（学習分析）

#### FR-ANALYTICS-002: 教育機関向け分析
**優先度**: P1  
**説明**: 機関レベルでの教育効果測定  
**受け入れ基準**:
- クラス・コース単位の統計
- 教員パフォーマンス分析
- リソース利用効率分析
- 比較分析（他機関との匿名比較）
- カスタムダッシュボード機能

**関連ユースケース**: UC-EU-012（学習分析）

### 7.2 ビジネス分析

#### FR-ANALYTICS-003: プロバイダー向けビジネス分析
**優先度**: P1  
**説明**: コンテンツプロバイダーの事業最適化支援  
**受け入れ基準**:
- コンテンツ利用統計
- 顧客セグメント分析
- 収益分析・予測
- 競合分析（匿名）
- マーケット動向レポート

**関連ユースケース**: UC-CP-008（財務分析）、UC-CP-009（顧客分析）

## 8. FR-INTEGRATION: LMS連携機能

### 8.1 標準プロトコル対応

#### FR-INTEGRATION-001: 教育技術標準対応
**優先度**: P0  
**説明**: 主要なeラーニング標準への準拠  
**受け入れ基準**:
- LTI（Learning Tools Interoperability）1.3対応
- SCORM 1.2/2004対応
- xAPI（Tin Can API）対応
- QTI（Question & Test Interoperability）対応
- CalDAV/iCal連携（スケジュール管理）

**関連ユースケース**: UC-EU-003（教育機関システム連携）

#### FR-INTEGRATION-002: 主要LMS連携
**優先度**: P1  
**説明**: 市場シェアの高いLMSとの直接連携  
**受け入れ基準**:
- Moodle、Canvas、Blackboard連携
- Google Classroom連携
- Microsoft Teams for Education連携
- 成績同期機能
- シングルサインオン

**関連ユースケース**: UC-EU-003（教育機関システム連携）

### 8.2 データ交換・同期

#### FR-INTEGRATION-003: リアルタイムデータ同期
**優先度**: P1  
**説明**: 外部システムとのシームレスなデータ連携  
**受け入れ基準**:
- RESTful API提供
- Webhook機能
- データ同期の競合解決
- 同期エラーハンドリング
- 同期履歴・ログ機能

**関連ユースケース**: UC-EU-003（教育機関システム連携）

## 9. 実装優先度マトリックス

### 9.1 MVP（Phase 1）機能
**P0要件のみ**:
- FR-USER-001, 003, 004, 005
- FR-CONTENT-001, 005
- FR-API-001, 002, 003
- FR-SEARCH-001
- FR-BILLING-001, 002
- FR-INTEGRATION-001

### 9.2 Phase 2機能
**重要なP1要件**:
- FR-USER-002
- FR-CONTENT-002, 003, 004
- FR-SEARCH-002, 003
- FR-BILLING-003
- FR-ANALYTICS-001, 002, 003
- FR-INTEGRATION-002, 003

### 9.3 Phase 3機能
**残りのP1およびP2要件**:
- 高度な分析機能
- AI機能の拡張
- サードパーティ統合の拡充

## 10. 技術考慮事項

### 10.1 スケーラビリティ要件
- 水平スケーリング対応
- マイクロサービスアーキテクチャ
- 非同期処理の活用
- キャッシュ戦略

### 10.2 セキュリティ要件
- OWASP Top 10対応
- 暗号化（保存時・転送時）
- 監査ログ
- 脆弱性スキャン

---

**次回作成予定**: 非機能要件詳細定義書  
**関連文書**:
- [要件定義書概要](00-requirements-overview.md)
- [システムアーキテクチャ設計書](../architecture/architecture-design-edu-mcp-service-20251019.md)
- [コンテンツプロバイダーユースケース](../usecases/content-provider-usecases.md)
- [エンドユーザーユースケース](../usecases/end-user-usecases.md)